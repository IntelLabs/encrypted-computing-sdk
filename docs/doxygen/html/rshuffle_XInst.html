<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Encrypted Computing SDK: RSHUFFLE - XInst</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Encrypted Computing SDK
   </div>
   <div id="projectbrief">A modular LLVM-inspired compiler pipeline that enables FHE implementations on HW accelerators like Intel&#39;s HERACLES .</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">RSHUFFLE - XInst </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_assembler_tools_hec_assembler_tools_docsrc_inst_spec_xinst_xinst_rshuffle"></a> Shuffles/routes NTT/iNTT outputs/inputs across tile pairs.</p>
<h1><a class="anchor" id="autotoc_md110"></a>
Definition</h1>
<p>Shuffles two register locations among the tile pairs, based on destinations defined by currently loaded routing table metadata.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">instr   </th><th class="markdownTableHeadNone">operand 0   </th><th class="markdownTableHeadNone">operand 1   </th><th class="markdownTableHeadNone">operand 2   </th><th class="markdownTableHeadNone">operand 3   </th><th class="markdownTableHeadNone">operand 4   </th><th class="markdownTableHeadNone">operand 5    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">rshuffle   </td><td class="markdownTableBodyNone">dst0   </td><td class="markdownTableBodyNone">dst1   </td><td class="markdownTableBodyNone">src0   </td><td class="markdownTableBodyNone">src1   </td><td class="markdownTableBodyNone">wait_cyc   </td><td class="markdownTableBodyNone">data_type   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md111"></a>
Timing</h1>
<p><b>Throughput</b>: 1 clock cycle</p>
<p><b>Latency</b>: 23 clock cycles</p>
<p><b>Special Latency</b>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">data_type   </th><th class="markdownTableHeadNone">latency    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ntt</code>   </td><td class="markdownTableBodyNone">5*<code>n</code> or 17 clock cycles    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>intt</code>   </td><td class="markdownTableBodyNone">5*<code>n</code> or 17 clock cycles   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md112"></a>
Restrictions</h2>
<p>Hardware resources are tied up for each <code>rshuffle</code>. Behavior when attempting to execute another <code>rshuffle</code> in the pipeline before the corresponding latency elapses is undefined.</p>
<ul>
<li>Two <code>rshuffle</code> instructions with the same <code>data_type</code> cannot overlap on <em>special latency</em>. This is: <code>rshuffle</code> instructions must be scheduled at multiples of 5 clock cycle intervals (up to 15 cycles) or at 17 or greater clock cycles from each other to avoid resource contention.</li>
<li>Two <code>rshuffle</code> instructions with different <code>data_type</code> cannot execute in the same bundle as there is only one routing table metadata available.</li>
</ul>
<p>Any other XInstruction can overlap with <code>rshuffle</code>. However, no XInstruction that writes to the same banks as an <code>rshuffle</code> can end in the same cycle of said <code>rshuffle</code>.</p>
<p>Instruction <code>rshuffle</code> will overwrite the contents of its output registers on its last cycle of latency. Values written to these same registers by any other XInstruction before <code>rshuffle</code> completes, will be overwritten at this time.</p>
<h1><a class="anchor" id="autotoc_md113"></a>
Details</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Operand   </th><th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>dst0</code>   </td><td class="markdownTableBodyNone">register   </td><td class="markdownTableBodyNone">Destination register where to shuffle <code>src0</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>dst1</code>   </td><td class="markdownTableBodyNone">register   </td><td class="markdownTableBodyNone">Destination register where to shuffle <code>src1</code>. Must be different than <code>dst0</code>.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>src0</code>   </td><td class="markdownTableBodyNone">register   </td><td class="markdownTableBodyNone">Source register to shuffle.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>src1</code>   </td><td class="markdownTableBodyNone">register   </td><td class="markdownTableBodyNone">Source register to shuffle. Must be different than <code>src0</code>.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>wait_cyc</code>   </td><td class="markdownTableBodyNone">int32   </td><td class="markdownTableBodyNone">Not used. Set to <code>0</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>data_type</code>   </td><td class="markdownTableBodyNone">string   </td><td class="markdownTableBodyNone">One of [<code>ntt</code>, <code>intt</code>] to indicate the type of shuffling depending on the corresponding matching operation. See notes.   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md114"></a>
Notes</h2>
<p><b>Uses SPAD-CE data path</b>: No</p>
<p>This instruction is mostly intended to shuffle values in registers among tile-pairs (akin to bit shuffling). Due to the nature of NTT and iNTT butterflies, their respective outputs and inputs are shuffled among tile-pairs by the mathematical operations. This instruction is intended to re-shuffle the outputs from an NTT or inputs for an iNTT into the correct bit order.</p>
<p>The typical usage to shuffle the tile-pairs of NTT outputs is as such:</p>
<div class="fragment"><div class="line">ntt, dst_top, dst_bot, src_top, src_bot, src_tw, stage, res # SL=1</div>
<div class="line">nop 4 # dependency latency for ntt results</div>
<div class="line">rshuffle, dst_top, dst_bot, dst_top, dst_bot, 0, ntt</div>
</div><!-- fragment --><p>Notice that while <code>rshuffle</code>'s source and destination registers are the same in the example above, the actual contents will be shuffled among the tile-pairs.</p>
<p>The typical usage to shuffle the tile-pairs of iNTT inputs is as such:</p>
<div class="fragment"><div class="line">rshuffle, src_top, src_bot, src_top, src_bot, 0, intt</div>
<div class="line">nop 21 # dependency latency for rshuffle results</div>
<div class="line">intt, dst_top, dest_bot, src_top, src_bot, src_tw, stage, res</div>
</div><!-- fragment --><p>Notice that while <code>rshuffle</code>'s source and destination registers are the same in the example above, the actual contents will be shuffled among the tile-pairs.</p>
<p>Routing table metadata defining shuffling patterns is loaded by <a class="el" href="nload_CInst.html#md_assembler_tools_hec_assembler_tools_docsrc_inst_spec_cinst_cinst_nload">`nload`</a>.</p>
<p>Parameter <code>data_type</code> is intended to select the correct routing table, however, in the current HERACLES implementation, only one routing table is availabe, and this parameter is used only for book keeping and error detection during scheduling. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
