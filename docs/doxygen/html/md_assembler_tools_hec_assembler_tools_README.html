<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Encrypted Computing SDK: HERACLES Code Generation Framework (Reference Implementation)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Encrypted Computing SDK
   </div>
   <div id="projectbrief">A modular LLVM-inspired compiler pipeline that enables FHE implementations on HW accelerators like Intel&#39;s HERACLES .</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">HERACLES Code Generation Framework (Reference Implementation) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The tools in this directory are the reference implementation of and Assembler codegenerator that takes a pre-generated Polynomial Instruction Set Architecture (P-ISA) program containing instructions that use an abstract, flat memory model for polynomial operations, such as those applied in homomorphic encryption (HE), and maps them to a corresponding set of instructions compatible with the HERACLES architecture, accounting for hardware restrictions, including memory management for the HERACLES memory model.</p>
<h1><a class="anchor" id="autotoc_md151"></a>
Table of Contents</h1>
<ol type="1">
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#inputs">Inputs</a></li>
<li><a href="#outputs">Outputs</a><ol type="a">
<li><a href="#assembler-output-instruction-specs">Assembler Instruction Specs</a></li>
</ol>
</li>
<li><a href="#executing-the-assembler">Executing the Assembler</a><ol type="a">
<li><a href="#running-for-a-pre-generated-kernel">Running for a Pre-Generated Kernel</a></li>
<li><a href="#hardware-spec-configuration">Hardware Spec Configuration</a></li>
</ol>
</li>
<li><a class="el" href="md_assembler_tools_hec_assembler_tools_debug_tools_README.html">Debug Tools</a></li>
</ol>
<h1><a class="anchor" id="autotoc_md152"></a>
Dependencies</h1>
<p>This project is Python based. Dependencies for the project are as follows:</p>
<ul>
<li>Python 3.10 or newer (Tested with 3.10)</li>
<li>Python pip 22.0 or newer</li>
<li><p class="startli">Requirements for the Python environment listed in file <code>requirements.txt</code>.</p>
<p class="startli">Install with <code>pip</code>:</p>
</li>
</ul>
<div class="fragment"><div class="line">pip3 install -r requirements.txt</div>
</div><!-- fragment --><p>It is recommended to install Python dependencies and run inside a <a href="https://virtualenv.pypa.io/en/stable/index.html">Python virtual environment</a> to avoid polluting the global Python.</p>
<h1><a class="anchor" id="autotoc_md153"></a>
Inputs</h1>
<p>The assembler framework requires two inputs:</p>
<ul>
<li><b>Abstract P-ISA kernel</b>: a kernel of instructions in abstract P-ISA where the memory model is abstracted with a flat, infinite structure.</li>
<li><b>Memory mapping metadata</b>: metadata information indicating the location where variable identifiers from the kernel are stored in the HERACLES HBM.</li>
</ul>
<p>Kernels and metadata are structured in comma-separated value (csv) files.</p>
<p>P-ISA kernels, along with corresponding memory metadata required as input to the assembler, are generated by the upper layers in the Encrypted Computing SDK stack, e.g. the <a href="../../README.md#encrypted-computing-sdk-phase-1-components-and-tasks">Program Mapper</a> component of the <a href="../../p-isa_tools">p-ISA tools</a>.</p>
<h1><a class="anchor" id="autotoc_md154"></a>
Outputs</h1>
<p>On a successful run, given a P-ISA kernel in file <code>filename.csv</code> (and corresponding memory metadata file), the assembler generates three files:</p>
<ul>
<li><code>filename.minst</code>: contains the list of instructions for the MINST queue.</li>
<li><code>filename.cinst</code>: contains the list of instructions for the CINST queue.</li>
<li><code>filename.xinst</code>: contains the list of instructions for the XINST queue.</li>
</ul>
<h2><a class="anchor" id="autotoc_md155"></a>
Assembler Output Instruction Specs</h2>
<p>The format for the output files and instruction set for HERACLES can be found at <a class="el" href="md_assembler_tools_hec_assembler_tools_docsrc_specs.html">Instruction Specification</a>.</p>
<h1><a class="anchor" id="autotoc_md156"></a>
Executing the Assembler</h1>
<h2><a class="anchor" id="autotoc_md157"></a>
Running for a Pre-Generated Kernel</h2>
<p>Given a P-ISA kernel (<code>filename.csv</code>) and corresponding memory mapping file (<code>filename.mem</code>), there are three steps to assemble them into HERACLES code.</p>
<ol type="1">
<li>Pre-process the P-ISA input kernel using <code><a class="el" href="he__prep_8py.html">he_prep.py</a></code>.</li>
</ol>
<div class="fragment"><div class="line"># pre-process kernel: outputs filename.tw.csv</div>
<div class="line">python3 he_prep.py filename.csv</div>
</div><!-- fragment --><ol type="1">
<li>Assemble the pre-processed result using <code><a class="el" href="he__as_8py.html">he_as.py</a></code>.</li>
</ol>
<div class="fragment"><div class="line"># use output from pre-processing as input to asm:</div>
<div class="line"># outputs filename.tw.minst, filename.tw.cinst, filename.tw.xinst</div>
<div class="line">python3 he_as.py filename.tw.csv --input_mem_file filename.mem</div>
</div><!-- fragment --><ol type="1">
<li>Link the assembler output into a HERACLES program using <code><a class="el" href="he__link_8py.html">he_link.py</a></code>.</li>
</ol>
<div class="fragment"><div class="line"># link assembled output (input prefix: filename.tw)</div>
<div class="line"># outputs filename.minst, filename.cinst, filename.xinst</div>
<div class="line">python3 he_link.py filename.tw --input_mem_file filename.mem --output_prefix filename</div>
</div><!-- fragment --><p>This will generate the main three output files in the same directory as the input file:</p>
<ul>
<li><code>filename.minst</code>: contains the list of instructions for the MINST queue.</li>
<li><code>filename.cinst</code>: contains the list of instructions for the CINST queue.</li>
<li><code>filename.xinst</code>: contains the list of instructions for the XINST queue.</li>
</ul>
<p>Intermediate files, if any, are kept as well.</p>
<p>The linker program is able to link several assembled kernels into a single HERACLES program, given a correct memory mapping for the resulting program.</p>
<p>This version of executing is intended for the assembler to be usable as part of a compilation pipeline.</p>
<p>Use commands below for more configuration information, including changing output directories, input and output filenames, etc.</p>
<div class="fragment"><div class="line">python3 he_prep.py -h</div>
<div class="line">python3 he_as.py -h</div>
<div class="line">python3 he_link.py -h</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md158"></a>
Hardware Spec Configuration</h2>
<h3><a class="anchor" id="autotoc_md159"></a>
Default Configuration</h3>
<p>The HERACLES assembler comes with default configurations for ISA and Memory parameters. These configurations are defined in JSON files located in the config folder:</p><ul>
<li><b>ISA Specification:</b> config/isa_spec.json</li>
<li><b>Memory Specification:</b> config/mem_spec.json</li>
</ul>
<p>These files contain default values for various parameters that affect the behavior of the assembler and linker. Users can modify these files directly, but it is recommended to create a copy and use the command-line flags to specify the path to the modified configuration files. This approach ensures that the original default files remain unchanged and can be used as a reference.</p>
<h3><a class="anchor" id="autotoc_md160"></a>
Modifying Configuration</h3>
<p>To modify the ISA or Memory specifications, follow these steps:</p><ul>
<li>Create a Copy: Copy the default JSON files from the config folder to a new location.</li>
<li>Edit the Copy: Modify the parameters in the copied JSON files as needed.</li>
<li><b>Specify the Path:</b> Use the <b>&ndash;<a class="el" href="namespaceisa__spec.html">isa_spec</a></b> and <b>&ndash;<a class="el" href="namespacemem__spec.html">mem_spec</a></b> command-line flags to specify the path to your modified configuration files when running the scripts.</li>
</ul>
<h3><a class="anchor" id="autotoc_md161"></a>
Additional Notes</h3>
<p>Memory Parameters: For <a class="el" href="he__as_8py.html">he_as.py</a> and <a class="el" href="he__link_8py.html">he_link.py</a>, certain memory parameters like spad_size and hbm_size can be overwritten directly from the command line, providing flexibility in configuration without modifying the JSON files. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
